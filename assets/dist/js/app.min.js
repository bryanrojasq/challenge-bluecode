(function($, wp) {

    var template = wp.template('my-template');

    var $tmpl = $('#tmpl-component-1');

    $tmpl.html(template({
        status: "Loading...",
        msg: "Default message",
        data: []
    }));

    $.ajax({
            url: "https://api.giphy.com/v1/gifs/search?api_key=ZovnOGzdE4et3xDCoy9L6XyqFTTd0W63&limit=9&q=" + window.giphyPluginSetting.giphyQuery,
            beforeSend: function(xhr) {
                // xhr.overrideMimeType("text/plain; charset=x-user-defined");
            },
            success: function(res) {
                
                console.log('success', res.data);

                var _list = '';

                $.each(res.data, function(key, item) {
                    // console.log(key, item)
                    _list += '<li><img src="' + item.images.original.url + '" /><button class="set-pic">Set as Profile Picture</button></li>';
                });

                $tmpl.html(template({
                    list: _list
                }));
            }
        })
        .done(function(data) {

        });

        $(document).on('click', '.set-pic', function() {
            
            var img_url = $(this).parent().find('img').attr('src');

            self.active = wp.ajax.send('exposed_ajax_action_get', {
                url: wp_headless_cms.admin_ajax,
                type: 'post',
                data: {
                    img_url : img_url
                },
                success: function(res) {
                    console.log('success', res);
                    // $tmpl.html(template({
                    //     status: res
                    // }));
                },
                error: function(res) {
                    var err = (res.statusText) ? res.statusText : res;
                    console.log('error', err);
                    // $tmpl.html(template({
                    //     status: err
                    // }));
                },
                complete: function() {
                    // self.active = false;
                }
            }).done(function(res) {
                console.log('done', res)
            }).fail(function(res) {
                var err = (res.statusText) ? res.statusText : res;
                console.log('fail', err)
            });
        });

})(jQuery, wp);